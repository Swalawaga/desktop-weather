#include <raylib.h>
#include <stdio.h>
#include <stdlib.h>
#include <math.h>

#define SNOWFLAKE_COUNT 600
#define MAX_AMPLITUDE 100
#define MIN_AMPLITUDE 50
#define RAIN 1

struct snow_flake {
  double x;
  int y;
  double amplitude;
  double periods;
  int size;
};

int random2(int min, int max) {
  return (rand() % (max - min + 1)) + min;
}

void populate(struct snow_flake *t) {
  t->x = random2(0, GetScreenWidth());
  t->y = random2(0, GetScreenHeight());
  t->amplitude = random2(-1, 1);
  t->periods = random2(1, 5);
  t->size = random2(3,5);
}


int main() {

  SetConfigFlags(FLAG_WINDOW_TRANSPARENT); 
  InitWindow(GetScreenWidth(), GetScreenHeight(), "Snow Land!");
  SetWindowState(FLAG_WINDOW_UNDECORATED);
  SetWindowState(FLAG_WINDOW_TOPMOST); 
  SetWindowState(FLAG_WINDOW_MOUSE_PASSTHROUGH);


  SetTargetFPS(60);

  struct snow_flake flakes[SNOWFLAKE_COUNT];
  for (int i = 0;i < SNOWFLAKE_COUNT;i++) {
    populate(&flakes[i]);
  }

  int iterator = 0;
  
  while (!WindowShouldClose()) {
    BeginDrawing();
    ClearBackground(BLANK); // Clear background with transparent color

    // Draw some elements on the transparent background
    /* DrawText("Hello, Transparent World!", 100, 200, 20, BLACK); */
    /* DrawRectangle(50, 50, 100, 100, Fade(RED, 0.7f)); // Draw a semi-transparent red rectangle */

    for(int i = 0; i < SNOWFLAKE_COUNT;i++) {
      if(RAIN) {
        DrawRectangle(flakes[i].x, flakes[i].y, flakes[i].size, flakes[i].size, RAYWHITE);
        flakes[i].y += abs(flakes[i].amplitude) * 0.4 + random2(0,1);
      } else {
        DrawRectangle(flakes[i].x, flakes[i].y, flakes[i].size, flakes[i].size+2, (Color) {0, 0, 255, 100});
        flakes[i].y += abs(flakes[i].amplitude) + random2(0,1);
      }
      
      flakes[i].x += flakes[i].amplitude * 0.4 * sin(1/flakes[i].periods * (iterator / 10000.));
      flakes[i].x += flakes[i].amplitude * 0.4 * cos((1/flakes[i].periods*100) * (iterator / 10000.));

      if(flakes[i].y > GetScreenHeight()) {
        flakes[i].y = 0;
      }
      /* printf("x: %d, y: %d", flakes[i].x, flakes[i].y); */
      iterator ++;
    }

    EndDrawing();
  }

  CloseWindow();
  return 0;
}
